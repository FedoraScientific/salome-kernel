#! /bin/sh

PYTHON_VERSION=python@PYTHON_VERSION@

# you must define SALOME_ROOT_DIR and SALOME_SITE_DIR (if you need it)

if test -n $SALOME_ROOT_DIR
then
  export PATH=$SALOME_ROOT_DIR/bin/salome:${PATH}
  export LD_LIBRARY_PATH=$SALOME_ROOT_DIR/lib/salome:${LD_LIBRARY_PATH}
  export PYTHONPATH=${SALOME_ROOT_DIR}/lib/salome:${SALOME_ROOT_DIR}/lib/$PYTHON_VERSION/site-packages/salome:${SALOME_ROOT_DIR}/share/salome/resources:${PYTHONPATH}
  # add bin, because some script are in (SALOME_SWIG) !!!!
  export PYTHONPATH=${SALOME_ROOT_DIR}/bin/salome:${PYTHONPATH}
fi
if test -n $SALOME_SITE_DIR
then
  export PATH=$SALOME_SITE_DIR/bin/salome:${PATH}
  export LD_LIBRARY_PATH=$SALOME_SITE_DIR/lib/salome:${LD_LIBRARY_PATH}
  export PYTHONPATH=${SALOME_SITE_DIR}/lib/salome:${SALOME_SITE_DIR}/lib/$PYTHON_VERSION/site-packages/salome:${SALOME_SITE_DIR}/share/salome/resources:${PYTHONPATH}
fi

if test -d $HOME/.salome/bin
then
  export PATH=$HOME/.salome/bin:${PATH}
fi
if test -d $HOME/.salome/lib
then
  export LD_LIBRARY_PATH=$HOME/.salome/lib:${LD_LIBRARY_PATH}
fi

# OCAF
export CSF_PluginDefaults=${SALOME_ROOT_DIR}/share/salome/resources
export CSF_ResourcesDefaults=${SALOME_ROOT_DIR}/share/salome/resources

export CSF_PATHData=${SALOME_ROOT_DIR}/share/salome

export tmp=/usr/tmp


if test $# = 0; then
  echo "runSession on ${HOSTNAME}"
  ./allkill

  ./runNS.sh
  sleep 2

  ./SALOME_Registry_Server --salome_session theSession &
  sleep 2

  ./SALOME_Container FactoryServer &

  ./SALOME_ContainerPy.py FactoryServerPy &
  sleep 2

  ./SALOME_Container SuperVisionContainer &

  ./SALOMEDS_Server&
  sleep 2

  ./SALOME_ModuleCatalog_Server \
-common ${SALOME_ROOT_DIR}/share/salome/resources/CatalogModuleGeneral.xml \
-personal ${HOME}/.salome/resources/CatalogModulePersonnel.xml &
sleep 2

  ./SALOME_Session_Server&

notifd -c ${SALOME_ROOT_DIR}/share/salome/resources/channel.cfg -DFactoryIORFileName=/tmp/${LOGNAME}_rdifact.ior -DChannelIORFileName=/tmp/${LOGNAME}_rdichan.ior&

fi

if test $# != 0; then
  if test $1 == "FactoryServer"; then
    echo "./allkill $1"
    ./allkill $1
  fi
# SALOME_Container usage: runSession SALOME_Container ServerName -ORBInitRef NameService=corbaname::hostname:tcpipPortNumber [/usr/bin/gdb]
# if it is a python container ServerName must be ended by 'Py'
  if test $# == 5; then
    echo "Starting ${SALOME_ROOT_DIR}/bin/salome/$1 $2 $3 $4 with debugger on ${HOSTNAME}"
    echo "Type : run $2 $3 $4"
    $5 ${SALOME_ROOT_DIR}/bin/salome/$1
  fi
  if test $# == 4; then
    echo "Starting ${SALOME_ROOT_DIR}/bin/salome/$1 $2 $3 $4 on ${HOSTNAME}"
    ${SALOME_ROOT_DIR}/bin/salome/$1 $2 $3 $4 &
  fi
  if test $# == 3; then
    echo "Starting $1 $2 $3 on ${HOSTNAME}"
    $1 $2 $3
  fi
  if test $# == 2; then
    echo "Starting $1 $2 on ${HOSTNAME}"
    $1 $2
  fi
  if test $# == 1; then
    echo "Starting $1 $2 on ${HOSTNAME}"
    $1 $2
  fi
fi
